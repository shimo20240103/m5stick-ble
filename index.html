<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>足組み検知グラフ</title>
<style>
body { font-family: sans-serif; text-align: center; }
button { font-size:16px; padding:10px; margin:10px; }
</style>
</head>
<body>
<h1>足組み検知</h1>
<button onclick="connect()">接続</button>
<div id="status">未接続</div>
<pre id="data">cross:0 t:0 k:0 15:0 45:0 90:0</pre>

<script>
const serviceUUID = "4fafc201-1fb5-459e-8fcc-c5c9c331914b";
const charUUID    = "beb5483e-36e1-4688-b7f5-ea073f74076a";

async function connect() {
  try {
    const device = await navigator.bluetooth.requestDevice({
      acceptAllDevices:true,
      optionalServices:[serviceUUID]
    });
    const server = await device.gatt.connect();
    const service = await server.getPrimaryService(serviceUUID);
    const characteristic = await service.getCharacteristic(charUUID);

    await characteristic.startNotifications();
    characteristic.addEventListener("characteristicvaluechanged", e=>{
      const value = new TextDecoder().decode(e.target.value);
      const parts = value.split(',');
      if(parts.length >= 6){
        const cross = parts[0];
        const t = parts[1];
        const k = parts[2];
        const c15 = parts[3];
        const c45 = parts[4];
        const c90 = parts[5];
        document.getElementById('data').textContent =
          `cross:${cross} t:${t}ms k:${k} 15:${c15} 45:${c45} 90:${c90}`;
      }
    });

    document.getElementById('status').textContent = "✅ 接続成功";
  } catch(err){
    console.error(err);
    document.getElementById('status').textContent = "❌ 接続失敗:"+err;
  }
}
</script>
</body>
</html>
